<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Make a more complex call
">
<title>Make a more complex call • epair</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Make a more complex call">
<meta property="og:description" content="Make a more complex call
">
<meta property="og:image" content="https://docs.ropensci.org/epair/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">epair</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/epair.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_ananomyEPARequest.html">The Anatomy of an EPA API request</a>
    <a class="dropdown-item" href="../articles/a02_ClarificationTerm.html">Clarification on terminology</a>
    <a class="dropdown-item" href="../articles/a03_Installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/a04_setup.html">Setup</a>
    <a class="dropdown-item" href="../articles/a05_making-your-first-call.html">Making your first call</a>
    <a class="dropdown-item" href="../articles/a06_make-a-more-complex-call.html">Make a more complex call</a>
    <a class="dropdown-item" href="../articles/a07_wrap-up.html">Summary</a>
    <a class="dropdown-item" href="../articles/a08_Endpoints.html">Finding endpoints</a>
    <a class="dropdown-item" href="../articles/a09_Services.html">Navigating API Services</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/epair/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Make a more complex call</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/epair/blob/HEAD/vignettes/a06_make-a-more-complex-call.Rmd" class="external-link"><code>vignettes/a06_make-a-more-complex-call.Rmd</code></a></small>
      <div class="d-none name"><code>a06_make-a-more-complex-call.Rmd</code></div>
    </div>

    
    
<p>Some calls require additional API variables like the state or county of interest. For these calls, we can easily add variables to the base call by passing them in as arguments to a <code>get</code> function, or as a second argument to <code><a href="../reference/perform.call.html">perform.call()</a></code>.</p>
<div class="section level2">
<h2 id="option-1-user-friendly-functions">Option 1: User friendly functions<a class="anchor" aria-label="anchor" href="#option-1-user-friendly-functions"></a>
</h2>
<div class="section level3">
<h3 id="adding-a-single-variable">Adding a single variable<a class="anchor" aria-label="anchor" href="#adding-a-single-variable"></a>
</h3>
<p>To start off, suppose we want to find out what counties and respective parameter codes exist for North Carolina. We can again use the <code>services</code> object, and check its <code>List</code> service as in <a href="../../docs/Tutorial/making-your-first-call">Making your first call</a>.</p>
<p><img src="img/complex_call/counties_by_state.png"></p>
<p>It looks like the <code>Counties by state</code> filter would be appropriate since we’re trying to determine the county parameter codes for North Carolina.</p>
<p>This specific service and filter can be done through <code><a href="../reference/get_counties_in_state.html">get_counties_in_state()</a></code>. Each <code>get</code> function has defined arguments for each required and optional variable. All of these functions and the documentation on variables for each are available in the <a href="../../Reference">Reference</a> page. We can add each of these variables by passing them as arguments through the user friendly functions.</p>
<p>Notice we have a required variable <code>state.fips</code>. Since we’re looking for counties in North Carolina, we can use the parameter code for North Carolina as the entry for <code>state</code>. We were able to determine all parameter codes for states in <a href="../../docs/Tutorial/making-your-first-call">Making your first call</a> so we look at our output there and find that the parameter code for North Carolina is <code>37</code>.</p>
<p>For our example, once we know our specific state code for North Carolina, all we have to do is pass it as an argument in the corresponding function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_counties_in_state.html">get_counties_in_state</a></span><span class="op">(</span>state.fips <span class="op">=</span> <span class="st">'37'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-multiple-variables">Adding multiple variables<a class="anchor" aria-label="anchor" href="#adding-multiple-variables"></a>
</h3>
<p>Similar to single variables, our higher level functions will require parameters for the service of our choice.</p>
<p>Suppose, for instance, we’re interested in finding daily ozone data for North Carolina, starting January 1, 2020 and ending on January 2, 2020, and we have determined the correct parameter codes for each API variable (please see <a href="../Useful-Features/Services">Navigating API services</a> or <a href="../../docs/Useful-Features/Variables">Figuring out API variables</a> to understand how we could go about determining proper parameter codes for each of these variables).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_daily_summary_in_state.html">get_daily_summary_in_state</a></span><span class="op">(</span>bdate <span class="op">=</span> <span class="st">'20200101'</span>, </span>
<span>                                     edate <span class="op">=</span> <span class="st">'20200102'</span>,</span>
<span>                                     state.fips <span class="op">=</span> <span class="st">'37'</span>,</span>
<span>                                     param <span class="op">=</span> <span class="st">'44201'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="option-2-manually-placing-the-call">Option 2: Manually placing the call<a class="anchor" aria-label="anchor" href="#option-2-manually-placing-the-call"></a>
</h2>
<div class="section level3">
<h3 id="adding-a-single-variable-1">Adding a single variable<a class="anchor" aria-label="anchor" href="#adding-a-single-variable-1"></a>
</h3>
<p>Similar to before, we can also go about placing the call through another method by manually finding the endpoint. From before, we can locate the endpoint through the <code>services</code> object, check its <code>List</code> service, and select the filter we are looking for.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span></span></code></pre></div>
<pre><code><span><span class="co">## $Endpoint</span></span>
<span><span class="co">## [1] "list/countiesByState"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $RequiredVariables</span></span>
<span><span class="co">## [1] "email, key, state"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $OptionalVariables</span></span>
<span><span class="co">## [1] ""</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Example</span></span>
<span><span class="co">## [1] "Example; returns all counties in North Carolina:https://aqs.epa.gov/data/api/list/countiesByState?email=test@aqs.api&amp;key=test&amp;state=37"</span></span></code></pre>
<p>Now, we can perform the call by putting together the endpoint for listing counties by state and the particular state we’re interested.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span><span class="op">$</span><span class="va">Endpoint</span></span>
<span><span class="va">state.code</span> <span class="op">&lt;-</span> <span class="st">'37'</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">state.code</span>, name <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>Note that we specified the additional variables we’d be adding with <code>variables = state.code</code>, and we inserted the API variable name as <code>name = state</code> in the function. An alternative is to simply declare the parameter code with the API variable name as follows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="va">services</span><span class="op">$</span><span class="va">List</span><span class="op">$</span><span class="va">Filters</span><span class="op">$</span><span class="va">`Counties by State`</span><span class="op">$</span><span class="va">Endpoint</span></span>
<span><span class="va">state</span> <span class="op">&lt;-</span> <span class="st">'37'</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">state</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-multiple-variables-1">Adding multiple variables<a class="anchor" aria-label="anchor" href="#adding-multiple-variables-1"></a>
</h3>
<p>In the case of multiple variables, we can make a list of variables and pass the list into <code><a href="../reference/perform.call.html">perform.call()</a></code> as the second argument.</p>
<p>From before, we’re interested in finding daily ozone data for North Carolina, starting January 1, 2020 and ending on January 2, 2020, and we have determined the correct parameter codes for each API variable.</p>
<p>For this, we create a list that has the appropriate API variable names declared for parameter codes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">'dailyData/byState'</span></span>
<span><span class="va">variable.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">'37'</span>, </span>
<span>                      <span class="st">"bdate"</span> <span class="op">=</span> <span class="st">'20200101'</span>, </span>
<span>                      <span class="st">"edate"</span> <span class="op">=</span> <span class="st">'20200102'</span>, </span>
<span>                      <span class="st">"param"</span> <span class="op">=</span> <span class="st">'44201'</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, variables <span class="op">=</span> <span class="va">variable.list</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="caching-a-call">Caching a call<a class="anchor" aria-label="anchor" href="#caching-a-call"></a>
</h2>
<p>Calling the same large dataset frequently can take time to load each time, but we can cache this data by storing it in the user’s specified directory for convenience. In each <code>get</code> function and <code><a href="../reference/perform.call.html">perform.call()</a></code> we can specify as an argument whether the call is cached or not and the directory the call is saved in.</p>
<p>For example, if we plan to use the daily ozone data for North Carolina from January 1, 2020 to March 1, 2020 many times over, we can specify we want to cache this data in user friendly functions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_daily_summary_in_state.html">get_daily_summary_in_state</a></span><span class="op">(</span>bdate <span class="op">=</span> <span class="st">'20200101'</span>, </span>
<span>                                     edate <span class="op">=</span> <span class="st">'20200102'</span>,</span>
<span>                                     state.fips <span class="op">=</span> <span class="st">'37'</span>,</span>
<span>                                     param <span class="op">=</span> <span class="st">'44201'</span>,</span>
<span>                                     cached <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                     cache_directory <span class="op">=</span> <span class="st">"~/epair/cache"</span><span class="op">)</span></span></code></pre></div>
<p>Or similarly, cache this data using the endpoint method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">'dailyData/byState'</span></span>
<span><span class="va">variable.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"state"</span> <span class="op">=</span> <span class="st">'37'</span>, </span>
<span>                      <span class="st">"bdate"</span> <span class="op">=</span> <span class="st">'20200101'</span>, </span>
<span>                      <span class="st">"edate"</span> <span class="op">=</span> <span class="st">'20200301'</span>, </span>
<span>                      <span class="st">"param"</span> <span class="op">=</span> <span class="st">'44201'</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/perform.call.html">perform.call</a></span><span class="op">(</span>endpoint <span class="op">=</span> <span class="va">endpoint</span>, </span>
<span>                       variables <span class="op">=</span> <span class="va">variable.list</span>, </span>
<span>                       cached <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       cache_directory <span class="op">=</span> <span class="st">"~/epair/cache"</span><span class="op">)</span></span></code></pre></div>
<p>Without specification of these arguments, the <code>get</code> and <code><a href="../reference/perform.call.html">perform.call()</a></code> functions default will always cache the call in the directory “~/epair/cache” based in the current working directory.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
